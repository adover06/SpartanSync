{% extends "base.html" %}

{% block content %}
<div class="max-w-7xl mx-auto grid grid-cols-12 gap-6">
    <section class="col-span-12 lg:col-span-8">
        <div class="flex items-center justify-between mb-4">
            <h2 class="text-2xl font-bold">Your Courses</h2>
            {% if current_user.is_authenticated and current_user.role == 'instructor' %}
                <a href="{{ url_for('main.assignment_create') }}" class="text-sm text-indigo-600 hover:underline">Create assignment</a>
            {% endif %}
        </div>
        {% if classes %}
            <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6">
                {% for cls in classes %}
                    <a href="{{ cls.link or url_for('main.courses') }}" class="block h-full p-4 rounded-xl shadow bg-white border border-gray-100 hover:border-indigo-200">
                        <p class="text-xs uppercase tracking-wide text-gray-500">{{ cls.course_code }}</p>
                        <h3 class="text-lg font-semibold mt-1">{{ cls.title or cls.course_name }}</h3>
                        <p class="text-sm text-gray-600 mt-2">{{ cls.description }}</p>
                        <p class="text-xs text-indigo-600 mt-3">View class overview →</p>
                    </a>
                {% endfor %}
            </div>
        {% else %}
            <p class="inline-block mt-2 text-blue-600 bg-blue-50 px-3 py-2 rounded-md">No classes available.</p>
        {% endif %}
    </section>

    <aside class="col-span-12 lg:col-span-4 space-y-6">
        <div class="bg-white rounded-lg shadow p-4">
            <div class="mb-4 flex items-center justify-between">
                <h3 class="text-xl font-semibold">Assignments</h3>
                <a href="{{ url_for('main.assignment_list') }}" class="text-sm text-blue-600 hover:underline">View all</a>
            </div>
            {% if assignments %}
                <div class="space-y-3">
                    {% for a in assignments %}
                        <a href="{{ url_for('main.assignment_detail', assignment_id=a.id) }}" class="block p-3 rounded border border-gray-100 hover:border-blue-200">
                            <div class="flex justify-between text-sm text-gray-500">
                                <span>{{ a.due_date.strftime('%b %d, %I:%M %p') }}</span>
                                <span>{{ a.points }} pts</span>
                            </div>
                            <h4 class="text-lg font-medium text-gray-900 mt-1">{{ a.title }}</h4>
                            <p class="text-xs uppercase tracking-wide text-gray-500">{{ a.course.course_name if a.course else 'General' }}</p>
                            <p class="text-sm text-gray-600">{{ a.description[:80] }}{% if a.description|length > 80 %}...{% endif %}</p>
                            <div class="mt-2">
                                {% set badge = a.progress_badge %}
                                <span class="text-xs px-2 py-1 rounded {{ badge.class }}">{{ badge.label }}</span>
                            </div>
                        </a>
                    {% endfor %}
                </div>
            {% else %}
                <p class="inline-block mt-2 text-blue-600 bg-blue-50 px-3 py-2 rounded-md">No assignments available.</p>
            {% endif %}
        </div>

        <div class="bg-white rounded-lg shadow p-4">
            <div class="mb-3 flex items-center justify-between">
                <h3 class="text-xl font-semibold">Announcements</h3>
                <a href="{{ url_for('main.announcements') }}" class="text-sm text-blue-600 hover:underline">View all</a>
            </div>
            {% if announcements %}
                <div class="space-y-4">
                    {% for note in announcements %}
                        <a href="{{ url_for('main.announcement_detail', announcement_id=note.id) }}" class="block">
                            <p class="text-xs text-gray-500">
                                {{ note.created_at.strftime('%b %d, %Y') }} • {{ note.course.course_name if note.course else 'General' }}
                            </p>
                            <h4 class="text-base font-semibold text-gray-900">{{ note.title }}</h4>
                            <p class="text-sm text-gray-600">{{ note.body[:100] }}{% if note.body|length > 100 %}...{% endif %}</p>
                        </a>
                    {% endfor %}
                </div>
            {% else %}
                <p class="text-sm text-gray-500">No announcements yet.</p>
            {% endif %}
        </div>
    </aside>
</div>
{% endblock %}
